---
// Layout.astro: Shared layout for all pages
import { ViewTransitions } from 'astro:transitions';
import '../styles/tailwind.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  ogType?: string;
  noindex?: boolean;
}

const { 
  title = 'AI Stats Dashboard - Compare AI Model Pricing & Performance', 
  description = 'Compare AI model pricing, performance benchmarks, and technical specifications. Real-time data for GPT-4, Claude, Gemini, and more AI models.',
  image = '/jonathan.avif',
  ogType = 'website',
  noindex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;
const ogImageURL = new URL(image, Astro.site).href;
---
<html lang="en" transition:animate="none">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/webp" href="/favicon.webp" />
    
    <!-- Preload critical font to improve LCP -->
    <link rel="preload" href="/fonts/nebula sans/NebulaSans-Book.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="stylesheet" href="/fonts/nebula sans/nebula-sans.css" />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />
    {noindex ? <meta name="robots" content="noindex, nofollow" /> : <meta name="robots" content="index, follow" />}
    <meta name="author" content="Jonathan Reed" />
    <meta name="theme-color" content="#191724" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:site_name" content="AI Stats" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:creator" content="@jonathanrayreed" />
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "AI Stats",
      "description": "Compare AI model pricing, performance benchmarks, and technical specifications",
      "url": Astro.site?.href || canonicalURL,
      "author": {
        "@type": "Person",
        "name": "Jonathan Reed",
        "url": "https://jonathanrreed.com"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": `${Astro.site?.href || canonicalURL}?q={search_term_string}`,
        "query-input": "required name=search_term_string"
      }
    })} />
    
    <ViewTransitions />
    <style is:global>
      :root {
        /* Ros Pine Night (default) */
        --base: #191724;
        --surface: #1f1d2e;
        --overlay: #26233a;
        --muted: #6e6a86;
        --subtle: #908caa;
        --text: #e0def4;
        --love: #eb6f92;
        --gold: #f6c177;
        --rose: #ebbcba;
        --pine: #31748f;
        --foam: #9ccfd8;
        --iris: #c4a7e7;
        --highlight-low: #21202e;
        --highlight-med: #403d52;
        --highlight-high: #524f67;

        /* Legacy aliases for compatibility */
        --surface-0: var(--base);
        --surface-1: var(--surface);
        --surface-2: var(--overlay);
        --text-1: var(--text);
        --text-2: var(--subtle);
        --accent: var(--foam);
        --accent-2: var(--pine);

        /* Sizing & spacing */
        --radius-s: 8px;
        --radius-m: 12px;
        --radius-l: 16px;
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.5rem;
        --space-6: 2rem;
        --space-7: 3rem;

        /* Layout */
        --container-max: 1200px;
        --container-pad: 1rem;
      }

      :root[data-theme='moon'] {
        --base: #232136;
        --surface: #2a273f;
        --overlay: #393552;
        --muted: #6e6a86;
        --subtle: #908caa;
        --text: #e0def4;
        --love: #eb6f92;
        --gold: #f6c177;
        --rose: #ea9a97;
        --pine: #3e8fb0;
        --foam: #9ccfd8;
        --iris: #c4a7e7;
        --highlight-low: #2a283e;
        --highlight-med: #44415a;
        --highlight-high: #56526e;
      }

      :root[data-theme='dawn'] {
        --base: #faf4ed;
        --surface: #fffaf3;
        --overlay: #f2e9e1;
        --muted: #9893a5;
        --subtle: #797593;
        --text: #575279;
        --love: #b4637a;
        --gold: #ea9d34;
        --rose: #d7827e;
        --pine: #286983;
        --foam: #56949f;
        --iris: #907aa9;
        --highlight-low: #f4ede8;
        --highlight-med: #dfdad9;
        --highlight-high: #cecacd;
      }

      /* Modern CSS reset (minimal) */
      *, *::before, *::after { box-sizing: border-box; }
      * { margin: 0; }
      html:focus-within { scroll-behavior: smooth; }
      html, body { height: 100%; }
      body { line-height: 1.6; -webkit-font-smoothing: antialiased; }
      img, picture, video, canvas, svg { display: block; max-width: 100%; height: auto; }
      input, button, textarea, select { font: inherit; }
      a { color: inherit; text-decoration-color: rgba(148, 197, 204, 0.35); text-underline-offset: 2px; }
      a:hover { text-decoration-color: var(--accent); }

      /* Global base */
      body {
        background: radial-gradient(1200px 800px at 10% -10%, rgba(156, 207, 216, 0.06), transparent 60%),
                    radial-gradient(800px 600px at 90% -10%, rgba(196, 167, 231, 0.05), transparent 60%),
                    var(--base);
        color: var(--text);
        font-family: 'Nebula Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Inter, system-ui, sans-serif;
        font-size: clamp(15px, 1.2vw, 16px);
        min-height: 100vh;
        color-scheme: dark;
      }

      /* Typography rhythm */
      h1 { font-size: clamp(1.75rem, 3vw, 2.25rem); line-height: 1.2; letter-spacing: -0.01em; }
      h2 { font-size: clamp(1.4rem, 2.4vw, 1.75rem); line-height: 1.25; }
      h3 { font-size: clamp(1.1rem, 1.8vw, 1.25rem); line-height: 1.3; }
      p  { color: var(--text-2); }

      /* Utility containers */
      .container {
        max-width: var(--container-max);
        margin-inline: auto;
        padding-inline: var(--container-pad);
        width: 100%;
      }

      @media (min-width: 768px) {
        :root { --container-pad: 1.25rem; }
      }

      @media (min-width: 1200px) {
        :root { --container-pad: 1.5rem; }
      }

      /* Focus styles for accessibility */
      :focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
        border-radius: 6px;
      }

      /* Prevent overflow bugs on small screens */
      #root, main, section { min-width: 0; }
      .no-overflow-x { overflow-x: hidden; }

      /* View Transitions - Smooth page navigation */
      @media (prefers-reduced-motion: no-preference) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation-duration: 0.3s;
        }
      }

      /* Disable transitions for users who prefer reduced motion */
      @media (prefers-reduced-motion: reduce) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation: none;
        }
      }
    </style>
    <script>
      (function () {
        if (typeof document === 'undefined') return;
        var THEME_KEY = 'ai-stats-theme';
        var VALID = ['night', 'moon', 'dawn'];
        var stored = null;
        try {
          stored = localStorage.getItem(THEME_KEY);
        } catch (e) {
          stored = null;
        }
        var theme = VALID.indexOf(stored || '') >= 0 ? stored : 'night';
        document.documentElement.dataset.theme = theme;
      })();
    </script>
    <slot name="head" />
  </head>
  <body>
    <slot />
  </body>
</html>
