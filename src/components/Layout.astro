---
// Layout.astro: Shared layout for all pages
import { ClientRouter } from "astro:transitions";
import "../styles/tailwind.css";
import ModelDrawer from "./ModelDrawer";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  ogType?: string;
  noindex?: boolean;
  robots?: string;
}

const siteName = "AI Stats";
const siteAuthor = "Jonathan Reed";

const {
  title = "AI Stats | AI model stats, LLM ranking & benchmarks by Jonathan Reed",
  description = "Compare AI model pricing, performance benchmarks, and technical specifications. Real-time data for GPT-4, Claude, Gemini, and more AI models.",
  image = "/jonathan.avif",
  ogType = "website",
  noindex = false,
  robots = "index, follow",
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;
const ogImageURL = new URL(image, Astro.site).href;
const robotsContent =
  robots || (noindex ? "noindex, nofollow" : "index, follow");
---

<html lang="en" transition:animate="none">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/webp" href="/favicon.webp" />

    <!-- Preload critical font to improve LCP -->
    <link
      rel="preload"
      href="/fonts/nebula sans/NebulaSans-Book.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="stylesheet" href="/fonts/nebula sans/nebula-sans.css" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />
    <meta name="robots" content={robotsContent} />
    <meta name="author" content={siteAuthor} />
    <meta name="theme-color" content="#191724" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:creator" content="@jonathanrayreed" />

    <!-- Structured Data (JSON-LD) -->
    <!-- SoftwareApplication schema intentionally omitted to avoid invalid review/rating rich-result requirements. -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: siteName,
        description:
          "Compare AI model pricing, performance benchmarks, and technical specifications",
        url: Astro.site?.href || canonicalURL,
        author: {
          "@type": "Person",
          name: siteAuthor,
          alternateName: "Jonathan R Reed",
          url: "https://jonathanrreed.com",
        },
        potentialAction: {
          "@type": "SearchAction",
          target: `${Astro.site?.href || canonicalURL}?q={search_term_string}`,
          "query-input": "required name=search_term_string",
        },
      })}
    />

    <ClientRouter />

    <!-- Theme initialization - runs before page render to prevent flash -->
    <script is:inline>
      var THEME_STORAGE_KEY = "theme";

      function applyTheme() {
        var saved = null;
        try {
          saved = localStorage.getItem(THEME_STORAGE_KEY);
        } catch (_error) {
          // ignore storage access failures
        }

        var isLight = saved === "light";
        document.documentElement.classList.toggle("light", isLight);

        var colorScheme = isLight ? "light" : "dark";
        document.documentElement.style.colorScheme = colorScheme;
        if (document.body) {
          document.body.style.colorScheme = colorScheme;
        }
      }
      applyTheme();
      document.addEventListener("astro:after-swap", applyTheme);
    </script>

    <!-- Developer console easter egg -->
    <script is:inline>
      (function () {
        if (typeof window === "undefined") return;

        const ascii = `
    ___  ________  ________     
   |\\  \\|\\   __  \\|\\   __  \\    
   \\ \\  \\ \\  \\|\\  \\ \\  \\|\\  \\   
 __ \\ \\  \\ \\   _  _\\ \\   _  _\\  
|\\  \\\\_\\  \\ \\  \\\\  \\\\ \\  \\\\  \\|
\\ \\________\\ \\__\\\\ _\\\\ \\__\\\\ _\\
 \\|________|\\|__|\\|__|\\|__|\\|__|
                                
        `;

        console.log(ascii);
        console.log("Hey there. Interested in code?");
        console.log("Check out my GitHub: https://github.com/JonathanRReed");
        console.log("Most of my sites repos are open source.");
      })();
    </script>
    <style is:global>
      :root {
        /* Neo-Brutalist (Dark) - Glass */
        --base: #0f0d14; /* Deeper base */
        --surface: rgba(31, 29, 46, 0.4); /* Translucent surface */
        --overlay: rgba(38, 35, 58, 0.6);
        --muted: #9490a8;
        --subtle: #b0acbe;
        --text: #e0def4;
        --love: rgba(235, 111, 146, 0.9);
        --gold: rgba(246, 193, 119, 0.9);
        --rose: rgba(235, 188, 186, 0.9);
        --pine: rgba(49, 116, 143, 0.9);
        --foam: rgba(156, 207, 216, 0.9);
        --iris: rgba(196, 167, 231, 0.9);
        --highlight-low: rgba(33, 32, 46, 0.5);
        --highlight-med: rgba(64, 61, 82, 0.5);
        --highlight-high: rgba(82, 79, 103, 0.5);
        --shadow-color: rgba(0, 0, 0, 0.4); /* Deeper shadow for contrast */
        --border-color: rgba(255, 255, 255, 0.12); /* Subtle edge */
        --glass-edge: inset 0 1px 0 rgba(255, 255, 255, 0.1); /* Frosted top rim */
      }

      /* Neo-Brutalist (Light) - Glass */
      html.light {
        --base: #f4f4f0;
        --surface: rgba(255, 255, 255, 0.5);
        --overlay: rgba(240, 240, 235, 0.6);
        --muted: #888888;
        --subtle: #555555;
        --text: #191724;
        --love: rgba(180, 99, 122, 0.8);
        --gold: rgba(234, 157, 52, 0.8);
        --rose: rgba(215, 130, 126, 0.8);
        --pine: rgba(40, 105, 131, 0.8);
        --foam: rgba(86, 148, 159, 0.8);
        --iris: rgba(144, 122, 169, 0.8);
        --highlight-low: rgba(244, 237, 232, 0.5);
        --highlight-med: rgba(223, 218, 217, 0.5);
        --highlight-high: rgba(206, 202, 205, 0.5);
        --shadow-color: rgba(0, 0, 0, 0.1);
        --border-color: rgba(0, 0, 0, 0.08);
        --glass-edge: inset 0 1px 0 rgba(255, 255, 255, 0.5);
        color-scheme: light;
      }

      /* Score colors - Brutalist Flat */
      .score-high {
        color: var(--pine);
      }
      .score-mid {
        color: var(--gold);
      }
      .score-low {
        color: #ff9933;
      }
      .score-poor {
        color: var(--love);
      }
      .score-none {
        color: var(--muted);
      }

      .score-bg-high {
        background: var(--pine);
        color: #000;
        border: 2px solid var(--border-color);
      }
      .score-bg-mid {
        background: var(--gold);
        color: #000;
        border: 2px solid var(--border-color);
      }
      .score-bg-low {
        background: #ff9933;
        color: #000;
        border: 2px solid var(--border-color);
      }
      .score-bg-poor {
        background: var(--love);
        color: #fff;
        border: 2px solid var(--border-color);
      }
      .score-bg-none {
        background: var(--highlight-low);
        color: var(--text);
        border: 2px solid var(--border-color);
      }

      /* Dark logo visibility */
      .provider-logo-dark {
        padding: 4px;
        background: #fff;
        border: 2px solid #000;
      }
      html.light .provider-logo-dark {
        background: transparent;
        border: none;
      }

      /* Shared sizing & spacing */
      :root {
        /* Legacy aliases */
        --surface-0: var(--base);
        --surface-1: var(--surface);
        --surface-2: var(--overlay);
        --text-1: var(--text);
        --text-2: var(--subtle);
        --accent: var(--foam);
        --accent-2: var(--pine);

        /* Sizing & spacing */
        --radius-s: 0px;
        --radius-m: 0px;
        --radius-l: 0px;
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.5rem;
        --space-6: 2rem;
        --space-7: 3rem;

        /* Layout */
        --container-max: 1200px;
        --container-pad: 1rem;
      }

      /* Modern CSS reset */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      * {
        margin: 0;
      }
      html:focus-within {
        scroll-behavior: smooth;
      }
      body {
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        background-color: var(--base);
        color: var(--text);
        font-family:
          "Nebula Sans",
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        font-size: clamp(15px, 1.2vw, 16px);
        min-height: 100vh;
        color-scheme: dark;
        position: relative;
        overflow-x: hidden;
      }

      /* Vibrant mesh gradient background for glass refraction */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        z-index: -1;
        background-image:
          radial-gradient(
            circle at 15% 50%,
            rgba(156, 207, 216, 0.12),
            transparent 40%
          ),
          radial-gradient(
            circle at 85% 30%,
            rgba(196, 167, 231, 0.12),
            transparent 40%
          ),
          radial-gradient(
            circle at 50% 80%,
            rgba(49, 116, 143, 0.1),
            transparent 50%
          );
        filter: blur(40px);
        opacity: 0.8;
        pointer-events: none;
      }

      html.light body::before {
        background-image:
          radial-gradient(
            circle at 15% 50%,
            rgba(86, 148, 159, 0.08),
            transparent 40%
          ),
          radial-gradient(
            circle at 85% 30%,
            rgba(144, 122, 169, 0.08),
            transparent 40%
          ),
          radial-gradient(
            circle at 50% 80%,
            rgba(40, 105, 131, 0.06),
            transparent 50%
          );
      }

      /* Typography */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-weight: 800;
        text-transform: uppercase;
      }
      h1 {
        font-size: clamp(2.5rem, 5vw, 4.5rem);
        line-height: 1.05;
        letter-spacing: -0.03em;
        text-wrap: balance;
      }
      h2 {
        font-size: clamp(1.75rem, 3vw, 2.5rem);
        line-height: 1.1;
      }
      h3 {
        font-size: clamp(1.25rem, 2vw, 1.5rem);
        line-height: 1.2;
      }
      p {
        color: var(--text);
        font-weight: 500;
      }

      .container {
        max-width: var(--container-max);
        margin-inline: auto;
        padding-inline: var(--container-pad);
        width: 100%;
      }

      @media (min-width: 768px) {
        :root {
          --container-pad: 2rem;
        }
      }

      /* Focus styles for accessibility */
      :focus-visible {
        outline: 4px solid var(--accent);
        outline-offset: 2px;
        border-radius: 0;
      }

      #root,
      main,
      section {
        min-width: 0;
      }
      .no-overflow-x {
        overflow-x: hidden;
      }

      @media (prefers-reduced-motion: no-preference) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation-duration: 0.2s;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        ::view-transition-old(root),
        ::view-transition-new(root) {
          animation: none;
        }
      }

      /* --- Brutalist Helpers --- */
      .brutalist-card {
        background: var(--surface);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--border-color);
        box-shadow:
          4px 4px 0px var(--shadow-color),
          var(--glass-edge);
        border-radius: 6px; /* Smooth but structured */
        transition:
          transform 0.1s ease,
          box-shadow 0.1s ease;
      }

      .brutalist-card:hover {
        transform: translate(-1px, -1px);
        box-shadow:
          6px 6px 0px var(--shadow-color),
          var(--glass-edge);
      }

      .brutalist-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--surface);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: var(--text);
        border: 1px solid var(--border-color);
        box-shadow:
          3px 3px 0px var(--shadow-color),
          var(--glass-edge);
        border-radius: 6px;
        font-weight: 700;
        text-transform: uppercase;
        padding: 0.5rem 1.5rem;
        cursor: pointer;
        transition:
          transform 0.1s ease,
          box-shadow 0.1s ease,
          background 0.1s ease;
      }

      .brutalist-button:hover {
        transform: translate(-1px, -1px);
        box-shadow:
          5px 5px 0px var(--shadow-color),
          var(--glass-edge);
        background: var(--highlight-low);
      }

      .brutalist-button:active {
        transform: translate(2px, 2px);
        box-shadow:
          0px 0px 0px var(--shadow-color),
          var(--glass-edge);
      }

      /* Fade in animations */
      .fade-in-section,
      .stagger-item {
        opacity: 0;
        transform: translateY(10px);
        transition:
          opacity 0.3s ease-out,
          transform 0.3s ease-out;
      }
      .fade-in-section.is-visible,
      .stagger-item.is-visible {
        opacity: 1;
        transform: none;
      }

      /* Respect reduced motion */
      @media (prefers-reduced-motion: reduce) {
        .fade-in-section,
        .stagger-item {
          opacity: 1;
          transform: none;
          transition: none;
        }
        .brutalist-card,
        .brutalist-button {
          transition: none;
        }
      }
    </style>
    <slot name="head" />
  </head>
  <body>
    <slot />
    <ModelDrawer client:load />

    <!-- Premium effects initialization -->
    <script is:inline>
      (function () {
        function initPremiumEffects(isNavigation) {
          // If navigating via View Transitions, show elements immediately (skip animations)
          if (isNavigation) {
            document
              .querySelectorAll(".fade-in-section, .stagger-item")
              .forEach(function (el) {
                el.classList.add("is-visible");
              });
          } else {
            // Scroll-triggered fade-in animations - only on initial load
            var fadeObserver = new IntersectionObserver(
              function (entries) {
                entries.forEach(function (entry) {
                  if (entry.isIntersecting) {
                    entry.target.classList.add("is-visible");
                  }
                });
              },
              { threshold: 0.01, rootMargin: "50px 0px 0px 0px" },
            );

            document
              .querySelectorAll(".fade-in-section")
              .forEach(function (el) {
                fadeObserver.observe(el);
              });

            // Staggered card animations - only on initial load
            var staggerObserver = new IntersectionObserver(
              function (entries) {
                entries.forEach(function (entry) {
                  if (entry.isIntersecting) {
                    var items = entry.target.querySelectorAll(
                      ".stagger-item:not(.is-visible)",
                    );
                    items.forEach(function (item, index) {
                      setTimeout(function () {
                        item.classList.add("is-visible");
                      }, index * 40);
                    });
                  }
                });
              },
              { threshold: 0.01, rootMargin: "50px 0px 0px 0px" },
            );

            document
              .querySelectorAll(".stagger-container")
              .forEach(function (el) {
                staggerObserver.observe(el);
              });
          }

          // Subtle 3D tilt on cards - always re-attach on navigation
          document.querySelectorAll(".tilt-card").forEach(function (card) {
            // Remove old listeners by cloning
            var newCard = card.cloneNode(true);
            card.parentNode.replaceChild(newCard, card);

            newCard.addEventListener("mousemove", function (e) {
              var rect = newCard.getBoundingClientRect();
              var x = (e.clientX - rect.left) / rect.width;
              var y = (e.clientY - rect.top) / rect.height;
              var tiltX = (y - 0.5) * 6;
              var tiltY = (x - 0.5) * -6;
              newCard.style.transform =
                "perspective(1000px) rotateX(" +
                tiltX +
                "deg) rotateY(" +
                tiltY +
                "deg) translateY(-4px)";
            });
            newCard.addEventListener("mouseleave", function () {
              newCard.style.transform = "";
            });
          });
        }

        // Run on initial load (with animations)
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", function () {
            initPremiumEffects(false);
          });
        } else {
          initPremiumEffects(false);
        }

        // On View Transition navigation, skip animations and show immediately
        document.addEventListener("astro:page-load", function () {
          initPremiumEffects(true);
        });
      })();
    </script>
  </body>
</html>
